{% extends "ArchitectureBundle::layoutArchitecture.html.twig" %}

{% block title %}
    Statistiques - {{ parent() }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
        google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(function () {
            drawChartOneYear(0);
            drawChartAllYears();
        });

        var ventesYear = {{ ventesYear|raw }};
        var ventesMonths = {{ ventesMonth|raw }};
        ventesYear.forEach(function (value, i) {
            $('#selectYears').append($('<option>', {
                value: i,
                text: (new Date().getFullYear() - i) + '/' + (new Date().getFullYear() - i + 1)
            }));
        });

        $('#selectYears').change(function () {
            drawChartOneYear($('#selectYears').val());
        });

        // Callback pour créer le diagramme, l'instancier et le dessiner.
        function drawChartOneYear(index) {

            // Création de la datatable pour populer le diagramme.
            var data = new google.visualization.DataTable();
            console.log(ventesMonths[index]);
            data.addColumn('string', 'Vente');
            data.addColumn('number', 'Nombre');
            var months = ['Septembre', 'Octobre', 'Novembre', 'Décembre', 'Janvier', 'Février', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'Août'];
            for (var i=0; i<ventesMonths[index].length; i++) {
                data.addRow([months[i], parseInt(ventesMonths[index][i])]);
            }

            // Options du diagramme.
            var currentDate = new Date();
            var options = {
                title: "Nombre de vente(s) réalisée(s) durant l'année scolaire " + (currentDate.getFullYear() - index) + "/" + (currentDate.getFullYear() - index + 1),
                vAxis: {title: "Nombre de ventes"},
                hAxis: {title: 'Mois'},
                seriesType: 'bars',
                width: 1500,
                height: 300,
                animation:{
                    duration: 2000,
                    easing: 'out',
                    startup: true
                }
            };

            // Instancier et dessiner le diagramme (remplacer PieChart par BarChart pour avoir un diagramme bâtons).
            var chart = new google.visualization.ComboChart(document.getElementById('chart_vente'));
            chart.draw(data, options);
        }

        function drawChartAllYears() {
            // Some raw data (not necessarily accurate)
            var currentDate = new Date().getFullYear();
            var data = new google.visualization.DataTable();
            data.addColumn('string', 'Vente');
            data.addColumn('number', 'Nombre');

            ventesYear.reverse().forEach(function (value, i) {
                data.addRow(['' + (currentDate - i) + '/' + (currentDate - i + 1), parseInt(value['ventes'])]);
            });

            var options = {
                title : 'Vente(s) réalisée(s) par année scolaire',
                vAxis: {title: "Nombre de ventes"},
                hAxis: {title: 'Année scolaire'},
                seriesType: 'bars',
                width: ventesYear.length*200,
                height: 300,
                animation:{
                    duration: 3000,
                    easing: 'out',
                    startup: true
                }
            };

            var chart = new google.visualization.ComboChart(document.getElementById('chart_vente_years'));
            chart.draw(data, options);
        }

    </script>
{% endblock %}

{% block body%}
    <h1>Statistiques sur les ventes</h1>
    <select id="selectYears"></select>
    <div id="chart_vente"></div>
    <div id="chart_vente_years" {#style="width: 900px; height: 500px;"#}></div>
{% endblock %}

{#https://developers.google.com/chart/interactive/docs/gallery#}