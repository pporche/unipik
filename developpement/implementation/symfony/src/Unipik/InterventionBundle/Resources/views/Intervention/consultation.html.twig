{# version 1.00, date 13/05/2016, auteur Matthieu Martins-Baltar #}
{% extends "InterventionBundle::layout.html.twig" %}

{% block title %}

    Consulter une intervention - {{ parent() }}

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        function desattributeIntervention(event, id) {
            $.post("{{ path('intervention_self_desattribute') }}", {'id': id},
                function (data, status) {
                    $(event).attr('class', 'btn btn-primary');
                    $(event).text('S\'attribuer l\'intervention');
                    $(event).attr("onclick", "attributeIntervention(this, "+id+")");
                });
        }

        function attributeIntervention(event, id) {
            $.post("{{ path('intervention_self_attribute') }}", {'id': id},
                function (data, status) {
                    $(event).attr('class', 'btn btn-danger');
                    $(event).text('Se désattribuer l\'intervention');
                    $(event).attr("onclick", "desattributeIntervention(this, "+id+")");
                });
        }
    </script>

{% endblock %}

{% block body %}

    <div class="container">
        <div class="row">
            <section class="jumbotron col-sm-12 infoPrincip">
                <div>
                    <div class="row">
                        <h2 class="col-lg-7 titre">
                            Intervention
                        </h2>
                        {% if intervention.realisee %}
                            <p class="text-success"> Réalisée <span class="glyphicon glyphicon-ok"></span></p>
                        {% elseif intervention.benevole %}
                            {% if user==intervention.benevole %}
                                <button name="desattribution" type="button" class="btn btn-danger" onclick="desattributeIntervention(this, {{ intervention.id }})">
                                    Se désattribuer l'intervention
                                </button>
                            {% else %}
                                Attribuée à {{ intervention.benevole.prenom }} {{ intervention.benevole.nom }}
                            {% endif %}
                        {% else %}
                            <button name="attribution" type="button" class="btn btn-primary" onclick="attributeIntervention(this, {{ intervention.id }})">
                                S'attribuer l'intervention
                            </button>
                        {% endif %}
                        <h4 class="col-lg-9" >
                            {% if intervention.plaidoyer %}
                                Plaidoyer
                            {% elseif intervention.frimousse %}
                                Frimousse
                            {% else %}
                                Autre intervention
                            {% endif %}
                        </h4>
                        <img src="{{ asset('img/logo-gris.png') }}" class="logoGris" alt="logo gris">
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-sm-6">
                            <dl class="dl-horizontal">
                                <div class="col-sm-4 col-xs-12">
                                    <dt>
                                        <span class="glyphicon glyphicon-globe"></span> &nbsp Localisation:
                                    </dt>
                                </div>

                                <div class="col-sm-6 col-xs-offset-1 col-xs-11">
                                    <a href="">
                                        <em>
                                            {# Lien vers l'établissement#}

                                            {% if intervention.etablissement.nom == "" or intervention.etablissement.nom == NULL %}
                                                -
                                            {% else %}
                                                {{ intervention.etablissement.nom }}
                                            {% endif %} </em> </a>
                                </div>
                                <br>
                                <div class="col-sm-4 col-xs-12">
                                    <dt>
                                        <span class="glyphicon glyphicon-calendar"></span> &nbsp Date:
                                    </dt>
                                </div>
                                <div class="col-sm-6 col-xs-offset-1 col-xs-11">
                                    <em>{% if intervention.dateIntervention is empty %}
                                            --:--
                                        {% else %}
                                            {{ intervention.dateIntervention|date('d-m-Y') }}
                                        {% endif %}
                                    </em>
                                </div>
                                <div class="col-sm-4 col-xs-12">
                                    <dt>
                                        <span class="glyphicon glyphicon-time"></span> &nbsp Heure:
                                    </dt>
                                </div>
                                <div class="col-sm-6 col-xs-offset-1 col-xs-11">
                                    <em>{% if intervention.heure is empty %}
                                        --:--
                                        {% else %}
                                        {{ intervention.heure }}
                                        {% endif %}
                                    </em>
                                </div>


                                <div class="col-sm-4 col-xs-12">
                                    <dt>
                                        <span class="glyphicon glyphicon-circle-arrow-right"></span> &nbsp Lieu:
                                    </dt>
                                </div>
                                <div class="col-sm-6 col-xs-offset-1 col-xs-11">
                                    <em>{% if intervention.lieu is empty %}
                                            -
                                        {% else %}
                                            {{ intervention.lieu | capitalize }}
                                        {% endif %}</em>
                                </div>


                                <div class="col-sm-4 col-xs-12">
                                    <dt>
                                        <span class="glyphicon glyphicon-user"></span> &nbsp N de personnes:
                                    </dt>
                                </div>
                                <div class="col-sm-6 col-xs-offset-1 col-xs-11">
                                    <em>{% if intervention.nbPersonne is empty %}
                                            -
                                        {% else %}
                                            {{ intervention.nbPersonne }}
                                        {% endif %}</em>
                                </div>
                                {{ block('contenu') }}
                            </dl>
                        </div>
                        <div class="col-sm-6 col-xs-12">
                            <div class="row-fuild">
                                <iframe class="container span12"
                                        frameborder="0" scrolling="no" marginheight="0" marginwidth="0"
                                        src="http://www.openstreetmap.org/export/embed.html?bbox=8.5628,50.0781,8.8217,50.1877&amp;layer=mapnik"
                                        style="
                                        border: 1px solid black;
                                        height: 350px ;
                                        padding: 0px;
                                        "></iframe>
                            </div>
                        </div>
                    </div>


                </div>
            </section>
        </div>
        <div class="row">
            <div class="buttons">
                <a href="{{ path("intervention_admin_edit", {'id': intervention.id}) }}" class="btn btn-primary">
                    <span class="glyphicon glyphicon-pencil"> Modifier</span>
                </a>
                <a href="{{ path("intervention_admin_delete", {'id': intervention.id}) }}" class="btn btn-danger" onclick="return confirm('Souhaitez vous vraiment supprimer l\'intervention {{ intervention.id }} ?')">
                    <span class="glyphicon glyphicon-trash"> Supprimer </span>
                </a>
            </div>
        </div>
        <div class="row">
            <div class="col-sm-12 infoContainer">
                <div class="col-sm-3 containerOne">
                    <div class="circle circleOne">
                        <img src="{{ asset('img/bell.png') }}" alt="bell">
                    </div>
                    <!-- Si { intervention.remarques!=null } -->
                    <h3>Remarques : </h3>
                    <div class="row">
                        <div class="scrollspy-example col-lg-offset-1 col-sm-7" data-offset="0" data-target="#navbar-example" data-spy="scroll" style="
                            height: 200px;
                            overflow: auto;
                            position: relative;
                            border:1px solid #cccccc;
                            padding:10px;">
                                <em>{{ intervention.remarques | capitalize}}</em>
                        </div>
                    </div>
                </div>
                <div class="col-sm-3 containerTwo">
                    <div class="circle circleTwo">
                        <img src="{{ asset('img/location.png') }}" alt="location">
                    </div>
                    <h3>Comité de rattachement : </h3>
                    <div class="row">
                        <ul class="list-group col-lg-offset-1 col-sm-7 ">
                            &nbsp &nbsp &nbsp {% for dep in intervention.comite.departement %}
                            {{ dep.nom }}
                            {% endfor %}
                        </ul>

                    </div>
                </div>
                <div class="col-sm-3 containerThree">
                    <div class="circle circleThree">
                        <img src="{{ asset('img/telephone.png') }}" alt="telephone">
                    </div>
                    <h3>Contact : </h3>
                    <div class="row">
                        <div class="well col-lg-offset-1 col-sm-12">
                            <dl class="dl-horizontal">
                                {% if (intervention.demande.contact is not empty) %}
                                    <div class="col-sm-6 col-xs-12">
                                        <dt>
                                            Nom :
                                        </dt>
                                    </div>
                                    <div class="col-sm-6 col-xs-offset-1 col-xs-11 col-sm-offset-0">
                                        <em>{% if intervention.demande.contact.nom %}
                                                {{ intervention.demande.contact.nom | capitalize }}
                                            {% else %}
                                                -
                                            {% endif %}</em>
                                    </div>

                                    <div class="col-sm-6 col-xs-12">
                                        <dt>
                                            Prénom :
                                        </dt>
                                    </div>
                                    <div class="col-sm-6 col-xs-offset-1 col-xs-11 col-sm-offset-0">
                                        <em>{% if intervention.demande.contact.prenom %}
                                                {{ intervention.demande.contact.prenom | capitalize }}
                                            {% else %}
                                                -
                                            {% endif %}</em>
                                    </div>
                                    <div class="col-sm-6 col-xs-12">
                                        <dt>
                                            Tel fixe :
                                        </dt>
                                    </div>
                                    <div class="col-sm-6 col-xs-offset-1 col-xs-11 col-sm-offset-0">
                                        <em>{% if intervention.demande.contact.telFixe %}
                                                {{ intervention.demande.contact.telFixe }}
                                                {% else %}
                                            -
                                            {% endif %}
                                        </em>
                                    </div>


                                    <div class="col-sm-6 col-xs-12">
                                        <dt>
                                            Tel portable :
                                        </dt>
                                    </div>
                                    <div class="col-sm-6 col-xs-offset-1 col-xs-11 col-sm-offset-0">
                                        <em>{% if intervention.demande.contact.telPortable %}
                                                {{ intervention.demande.contact.telPortable }}
                                            {% else %}
                                                -
                                            {% endif %}</em>
                                    </div>

                                    {% else %}
                                    &nbsp &nbsp &nbsp Aucun contact.
                                {% endif %}
                            </dl>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



{% endblock %}


