{# version 1.00, date 13/05/2016, auteur Matthieu Martins-Baltar #}
{% extends "UserBundle::layout.html.twig" %}

{% block title %}

    Liste des bénévoles - {{ parent() }}

{% endblock %}

{% block body %}

    <section class="col-lg-2 col-md-2 col-sm-2">
        <div class="row">
            <div class='well'>

                {#{{ form_start(form, {'method': 'post', 'action': path('intervention_list'), 'attr': {'class': 'intervention_list form-sm'}}) }}#}
                <h5>Activité :</h5>
                {#{{ form_widget(form.typeIntervention) }}#}
                <br/>

                <h5>Responsabilité :</h5>
                {#{{ form_widget(form.date) }}#}
                <br/>

                <br/>

                <div>
                    <input id="submit" type="submit" value="OK" class="btn btn-primary"/>
                </div>
                {#{{ form_end(form) }}#}

            </div>
        </div>
    </section>

    <section class="col-lg-10 col-md-10 col-sm-10">
        <h1>Liste des Bénévoles</h1>

        <table class="table table-striped table-hover ">
            <thead>
            <tr>
                <th>#</th>

                {% set pathReq = [] %}
                {% if app.request.query.get('rowsPerPage') is not null %}
                    {% set pathReq = pathReq | merge({"rowsPerPage":app.request.query.get('rowsPerPage')})%}
                {% endif %}
                {% if field == "nom" %}
                    {%  if desc %}
                        <th>Nom <a class="sortButtonNom" id="sortButtonNom" href="{{ path('user_admin_list', pathReq | merge({"desc":false, "field":"nom"}) ) }}"><img src="{{ asset('img/sort-down.png') }}" class="sort sort-down" id="sortNom"/></a></th>
                    {% else %}
                        <th>Nom <a class="sortButtonNom" id="sortButtonNom" href="{{ path('user_admin_list', pathReq | merge({"desc":true, "field":"nom"}) ) }}"><img src="{{ asset('img/sort-up.png') }}" class="sort sort-up" id="sortNom"/></a></th>
                    {% endif %}
                {% endif %}

                <th>Prénom</th>
                <th>Responsabilité</th>
                <th>Activité</th>
                <th>Consulter</th>
                <th>Supprimer</th>
            </tr>


            </thead>
            <tbody>
            {% for benevole in listBenevoles|sort %}
                <tr id="checkboxes">
                    <td>{{ loop.index }}</td>
                    <td>{{ benevole.nom | capitalize }}</td>
                    <td>{{ benevole.prenom | capitalize }}</td>
                    <td id="idBenevole" hidden="hidden">{{ benevole.id }}</td>
                    <td name="resp">
                        {% if (benevole.responsabiliteActivite == "" or benevole.responsabiliteActivite == NULL) %}
                            <div class="col-lg-offset-1 ">

                            </div>
                        {% else %}
                            <div class="col-lg-offset-1 col-sm-7 ">
                                {% if ('plaidoyer' in benevole.responsabiliteActivite ) %}
                                        Plaidoyer <br>
                                {% endif %}
                                {% if ('frimousse' in benevole.responsabiliteActivite) %}
                                        Frimousse <br>
                                {% endif %}
                                {% if ('actions_ponctuelles' in benevole.responsabiliteActivite) %}
                                        Actions ponctuelles <br>
                                {% endif %}
                                {% if ('projets' in benevole.responsabiliteActivite) %}
                                        Projets <br>
                                {% endif %}
                                {% if ('projets' in benevole.responsabiliteActivite) %}
                                        Autre,
                                {% endif %}
                                {% if ('admin_comite' in benevole.responsabiliteActivite) %}
                                        Administrateur du comité <br>
                                {% endif %}
                                {% if ('admin_region' in benevole.responsabiliteActivite) %}
                                        Administrateur de la région <br>
                                {% endif %}
                            </div>
                        {% endif %}
                    </td>
                    <td name="act">
                        {% if (benevole.activitesPotentielles == "" or benevole.activitesPotentielles == NULL) %}
                            <div class="col-lg-offset-1 col-sm-7">

                            </div>
                        {% else %}
                            <div class="col-lg-offset-1 col-sm-7 ">
                                {#{% for act in  benevole.activitesPotentielles%}#}
                                    {#{{ act }}#}
                                {#{% endfor %}#}
                                {% if ('(plaidoyers)' in benevole.activitesPotentielles) %}
                                    Plaidoyer <br>
                                {% endif %}
                                {% if ('(frimousses)' in benevole.activitesPotentielles) %}
                                    Frimousse <br>
                                {% endif %}
                                {% if ('(actions_ponctuelles)' in benevole.activitesPotentielles) %}
                                    Actions ponctuelles <br>
                                {% endif %}
                                {% if ('(projets)' in benevole.activitesPotentielles) %}
                                    Projets <br>
                                {% endif %}
                                {% if ('(projets)' in benevole.activitesPotentielles) %}
                                    Autre <br>
                                {% endif %}
                                {% if ('(admin_comite)' in benevole.activitesPotentielles) %}
                                    Administrateur du comité <br>
                                {% endif %}
                                {% if ('(admin_region)' in benevole.activitesPotentielles) %}
                                    Administrateur de la région <br>
                                {% endif %}

                            </div>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{{ path('user_admin_profil_benevole', {'username': benevole.username}) }}">
                            <button type="button" class="btn btn-primary">Consulter le profil</button>
                        </a>
                    </td>
                    <td>
                    <td>
                        <div class="checkbox">
                            <label>
                                <input type="checkbox" name="type" id="{{ benevole.username }}">
                            </label>
                        </div>
                    </td>
                    {#<a href="{{ path("user_admin_delete", {'username': benevole.username}) }}">#}
                    {#<button type="button" class="btn btn-danger" onclick="ajaxGet('{{ path("user_admin_delete", {'username': benevole.username}) }}', supprimerBenevole())">Supprimer</button>#}
                    {#</a>#}
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </section>

    <div class="col-sm-offset-9 col-lg-offset-9 col-xs-offset-0 col-sm-3 col-lg-3 col-xs-offset-12">
        <div class="row">
            <a href="{{ path('fos_user_admin_register') }}">
                <button type="button" class="btn btn-success">Ajouter un bénévole</button>
            </a>
            <button type="button" class="btn btn-danger" onclick="deleteBenevoles()">Supprimer</button>
        </div>
    </div>

    <div class="col-md-12 text-center">
        {% set pathReq = [] %}
        {% if app.request.query.get('desc') is not null %}
            {% set pathReq = pathReq | merge({"desc":app.request.query.get('desc')}) | merge({"field":app.request.query.get('field')})%}
        {% endif %}
        <ul>Par page :
            <a href="{{ path('user_admin_list', pathReq | merge({"rowsPerPage":5}) ) }}">5</a>,
            <a href="{{ path('user_admin_list', pathReq | merge({"rowsPerPage":10}) ) }}">10</a>,
            <a href="{{ path('user_admin_list', pathReq | merge({"rowsPerPage":20}) ) }}">20</a>,
            <a href="{{ path('user_admin_list', pathReq | merge({"rowsPerPage":50}) ) }}">50</a>,
            <a href="{{ path('user_admin_list', pathReq | merge({"rowsPerPage":100}) ) }}">100</a>
        </ul>
        <ul class="pagination pagination-lg pager" id="myPager"></ul>
    </div>

{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script type="application/javascript">


        function formatMultiple(name) {
            var tdElements = document.getElementsByName(name);
            for (var i = 0; i < tdElements.length; i++) {
                listElement = document.createElement('ul');
                var text = tdElements[i].textContent;
                text = text.replace(/[{()}]/g, '');
                text = text.split(',');
                for (var j = 0; j < text.length; j++) {
                    if (text[j].trim() != '') {
                        itemElement = document.createElement('li');
                        itemElement.textContent = text[j];
                        listElement.appendChild(itemElement);
                    }
                }
                tdElements[i].innerHTML = '';
                tdElements[i].appendChild(listElement);
            }
        }

//        formatMultiple("act");
//        formatMultiple("resp");

        function deleteBenevoles() {
            var selected = [];

            $("input:checkbox:checked").each(function () {
                var $this = $(this);
                selected.push($this.attr("id"));
            });

            var usernames = JSON.stringify(selected)

            $.post("{{ path('user_admin_deletes') }}", {'usernames': usernames},
                function (data, status) {
                    for (i = 0; i < selected.length; i++) {
                        $("#" + selected[i]).closest('tr').remove();
                    }
                });
        }

    </script>
{% endblock %}
